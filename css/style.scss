@use "sass:selector";
@use "template" as *;

%aligntop {
	position: absolute;
	top: 0;
	left: 0;
	z-index: 9;
}

%buttonicon {
	@extend %aligntop;
	cursor: pointer;
	margin: 0;
	padding: 0;
	border: 0 none;
	height: $size-icon;
	width: $size-icon;
	background: {
		repeat: no-repeat;
		size: $size-icon $size-icon;
	}
}

.artsaver-check {
	@extend %buttonicon;

	&[data-color="green"] {
		background-image: $icon-check-green;
	}

	&[data-color="yellow"] {
		background-image: $icon-check-yellow;
	}

	&:hover,
	&:active {
		background-image: $icon-remove;
	}
}

.artsaver-download {
	@extend %buttonicon;
	display: none;
	background-image: $icon-download;

	:hover > & {
		display: block;
	}

	&:hover,
	&:active {
		background-image: $icon-download-hover;
	}
}

@keyframes rotation {
	0% {
		transform: rotate(0deg);
	}
	100% {
		transform: rotate(360deg);
	}
}

.artsaver-loading {
	@extend %buttonicon;
	animation: rotation 0.5s steps(12, end) infinite;
	background-image: $icon-loading;

	.artsaver-progress + & {
		background-size: $size-bar $size-bar;
		height: $size-bar;
		width: $size-bar;
	}
}

.artsaver-error {
	@extend %buttonicon;
	background-image: $icon-error;

	&:hover,
	&:active {
		background-image: $icon-error;
	}
}

#artsaver-tip {
	@extend %font;
	position: absolute;
	top: 0;
	border-radius: $radius;
	text-align: center;
	width: auto;
	z-index: 1000;
	overflow: hidden;
	display: grid;
	row-gap: 1px;

	transition: 0.5s ease-in;
	visibility: hidden;
	opacity: 0;

	color: var(--text);
	background-color: var(--color-2);

	&:hover,
	&:active,
	&[data-display="show"] {
		transition: none;
		visibility: visible;
		opacity: 1;
	}

	.info-label,
	.info-value {
		padding: ue(1) ue(6);
	}
	.info-label {
		background-color: var(--color-1);
	}
	.info-value {
		background-color: var(--color-0);
	}

	.user-value {
		grid-column: 2;
	}
	.home-icon {
		grid-column: 3;
	}
	.gallery-icon {
		grid-column: 4;
	}
	.id-value {
		grid-column: 2/5;
	}

	.user-link {
		@include mask-svg() {
			mask: {
				position: center;
				size: ue(12) ue(12);
			}
		}
		@include hover;

		border: none;
		box-sizing: border-box;
		padding: 0;
		width: ue(18);
		cursor: pointer;

		color: var(--text);

		&.home-icon::after {
			mask-image: $icon-home;
		}
		&.gallery-icon::after {
			mask-image: $icon-gallery;
		}
	}
}

.artsaver-holder {
	display: table;
	position: relative;
	margin: auto;
	border-collapse: collapse;
	text-align: center;
}

.artsaver-progress {
	@extend %aligntop;
	@extend %font;
	height: $size-bar;
	border-radius: $radius;
	overflow: hidden;
	width: 100%;
	background-color: $color-progress;
}

@keyframes animate-stripes {
	0% {
		background-position: 0 0;
	}
	100% {
		background-position: ($size-bar * -4) 0;
	}
}

.artsaver-bar {
	@extend %aligntop;
	height: 100%;

	animation: animate-stripes 1s linear infinite;
	border-radius: $radius;
	box-sizing: border-box;
	color: $color-progress-text;
	background: {
		color: $blue-0;
		image: linear-gradient(
			135deg,
			$blue-1 25%,
			transparent 25%,
			transparent 50%,
			$blue-1 50%,
			$blue-1 75%,
			transparent 75%,
			transparent
		);
		size: ($size-bar * 2) ($size-bar * 2);
	}
}

.artsaver-bar-text {
	text-align: right;
	white-space: nowrap;
	line-height: normal;
	padding: {
		left: calc(#{$size-bar} + #{ue(3)});
		right: ue(3);
	}
}

.artsaver-screen {
	display: flex;
	position: absolute;
	inset: 0;
	z-index: 9;
	pointer-events: none;

	background-color: $color-screen;

	&::after {
		$maxsize: 200px;
		$scale: 80%;
		display: block;
		position: relative;

		content: "";
		margin: auto;
		width: $scale;
		height: $scale;
		object-fit: contain;
		max: {
			width: $maxsize;
			height: $maxsize;
		}
		background: {
			position: center;
			image: $icon-check-flat;
			size: contain;
			repeat: no-repeat;
		}
	}
}

#artsaver-ui {
	@include themes;

	:focus-visible {
		outline: none;
	}

	.switch {
		@extend %switch;

		background-color: var(--color-2);

		margin: {
			left: 0;
			right: ue(6);
		}
	}

	.hide {
		display: none !important;
	}

	.row-button {
		@include mask-svg() {
			mask: {
				position: center;
				size: ue(12) ue(12);
			}
		}
		border: none;
		box-sizing: border-box;
		padding: 0;
		width: ue(24);
		cursor: pointer;

		color: var(--text);
		background-color: var(--color-1);
		font: {
			size: inherit !important;
			family: inherit;
		}

		&.link-icon::after {
			mask-image: $icon-ex-link;
		}
		&.folder-icon::after {
			mask-image: $icon-folder;
		}
		&.home-icon::after {
			mask-image: $icon-home;
		}
		&.gallery-icon::after {
			mask-image: $icon-gallery;
		}

		&:hover {
			background-color: var(--color-2);
		}
	}

	.artsaver-progress {
		position: relative;
		margin-top: ue(3);
		height: ue(16);
	}

	.artsaver-bar[style="width: 100%;"] {
		background: $blue-0;
	}

	.artsaver-bar-text {
		padding-left: ue(3);
	}

	%badge {
		display: inline;
		border-radius: $radius;
		padding: ue(3) ue(6);
		font-weight: 600;
	}

	.badge {
		@extend %badge;
		background-color: var(--color-1);
	}

	%stat {
		display: flex;
		gap: ue(9);
		justify-content: space-between;
		align-items: center;
		padding: ue(3) ue(9);
		white-space: nowrap;
		flex: 1;
	}

	.stat {
		@extend %stat;

		&.stat-button {
			@include hover(0, true, true);
			cursor: pointer;
		}
	}

	.stat-error {
		@extend %stat;
		flex: 0;
		color: var(--error-text);

		&.stat-button {
			@include hover(0, true, true, "error");
			cursor: pointer;
		}

		.badge {
			background-color: var(--error-1);
		}
	}

	.queue-stat {
		margin: 0 auto;
		padding: 0 ue(3);
	}

	.list-box {
		border-bottom: $border;
	}

	.list {
		max-height: 300px;
		overflow-y: auto;
	}

	.row {
		display: flex;

		&:not(:last-child) {
			border-bottom: $border;
		}
	}

	.row-text {
		flex: 1;
		padding: ue(3) ue(9);
		white-space: nowrap;
		overflow: hidden;
		min-width: 0;
		text-overflow: ellipsis;
	}

	.list-bar {
		padding: ue(3) ue(9);

		background-color: var(--color-1);
		border-top: $border;
	}

	.file-folder {
		display: none;
	}
}

#artsaver-info-bar {
	@extend %font;

	position: fixed;
	bottom: 8px;
	left: 8px;
	width: 350px;
	border-radius: $radius;
	box-shadow: $shadow;
	min-width: 150px;
	overflow: hidden;
	resize: horizontal;
	z-index: 1001;
	visibility: visible;
	opacity: 1;

	color: var(--text);
	background-color: var(--color-0);

	transition: {
		property: visibility, opacity, bottom;
		duration: 0.2s;
		timing-function: ease-out;
	}

	&.collapsed {
		bottom: 0;
		visibility: hidden;
		opacity: 0;
	}
}

#info-bar {
	display: flex;
}

#collapse {
	@include mask-svg() {
		mask: {
			position: center;
			size: ue(16) ue(16);
			image: $icon-collapse;
		}
	}
	@include hover;

	padding: ue(3) ue(9);
	width: ue(16);
	flex-shrink: 0;
	cursor: pointer;
}

#queue {
	padding: ue(3) ue(6);

	background-color: var(--color-1);
	border-top: $border;
}

#list-recent .row-text {
	gap: ue(3);
}

#list-files.show-folders .file-folder {
	display: inline;
}

#list-errors .row {
	color: var(--error-text);
	background-color: var(--error-0);

	&:not(:last-child) {
		border-bottom: ue(1) solid var(--error-1);
	}
}

#history-stats {
	flex: 1;
}

#queue-stats,
#history-stats {
	display: flex;
	white-space: nowrap;
}

#queue-stats {
	justify-content: space-evenly;
	min-width: min-content;
	gap: ue(6);
}

#list-files .list-bar {
	display: flex;
	gap: 0.5em;
	white-space: nowrap;
	align-items: center;

	input {
		display: none;
	}

	label {
		display: flex;
		align-items: center;
		margin: 0 auto;
		cursor: pointer;
	}
}

#artsaver-show-info-bar {
	$size: ue(36);
	position: fixed;
	bottom: 0;
	left: calc(-#{ue(19)} + 8px);

	width: $size * 2;
	height: $size;
	border-radius: $size $size 0 0;
	overflow: hidden;
	opacity: 0;
	z-index: 1002;
	font-size: 12px;

	&:hover {
		opacity: 1;
	}

	&.hide {
		display: none !important;
	}
}

#show-tab {
	@include mask-svg() {
		mask: {
			position: center;
			size: ue(16) ue(16);
			image: $icon-collapse;
		}
	}
	@include hover;

	position: relative;
	bottom: ue(-20);
	padding: ue(6) ue(9);
	width: ue(16);
	flex-shrink: 0;
	height: ue(16);
	margin: auto;
	scale: -1;
	border-radius: 0 0 ue(3) ue(3);
	opacity: 0.5;
	box-shadow: $shadow;
	cursor: pointer;
	transition: {
		property: opacity, bottom;
		duration: 0.1s;
		timing-function: ease-out;
	}

	&:hover {
		bottom: ue(-14);
		opacity: 1;
	}
}

#artsaver-test-button {
	position: fixed;
	top: 0;
	left: 0;
}

.artsaver-text-render {
	width: 0;
	height: 0;
	overflow: hidden;
	padding: 0;
	margin: 0;
	opacity: 0;
	white-space: pre-wrap;
}
